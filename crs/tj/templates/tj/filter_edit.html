<div class="modal fade" id="modal_filter" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" id="filter_title">Filter by {{ filter_type|title }}</h4>
            </div>
            <div class="modal-body">
                <div class="checkbox">
                    <label>
                        <input type="checkbox" id="check_all_none">
                        All/None
                    </label>
                    <script>
                        $('#check_all_none').click(function () {
                            if ($(this).is(':checked')) {
                                $('.others').prop("checked", true);
                            }
                            else {
                                $('.others').removeAttr("checked");
                            }
                        });
                    </script>
                </div>
                <hr/>
                <div style="height:500px; overflow:auto">
                    {% for i, row in filter_rows.iterrows %}
                    <div class="checkbox">
                        <label>
                            <input type="checkbox" class="others" id="fc_{{ row.code }}">
                            {{ row.name }}
                        </label>
                    </div>
                    {% endfor %}
                </div>

                <script>
                    var filtered_codes = getFilterCodes('{{ filter_type }}');

                    if (filtered_codes.length == 0) {
                        // check all boxes
                    } else {
                        for (var i = 0; i < filtered_codes.length; i++) {
                            var code = filtered_codes[i];
                            $('#fc_' + code).prop("checked", true);
                        }
                    }

                </script>
            </div>
            <div class="modal-footer">
<script>
        function submitFilterChanges() {
            var codes = [];
            $('input:checkbox[id^="fc_"]:checked').each( function (index, item) {
                var checkbox_id = $(this).attr('id');
                var code = checkbox_id.substring(3);
                codes.push(code);
            });

            if (codes.length == 0) {
                alert('Need to select at least one value');
                return;
            }

            $.ajax({
                url: "{% url 'query_filter_update' query.id filter_type %}",

                type: "POST",

                data: {
                    codes: codes
                },

                success: function (html) {
                    $("#modal_filter").modal('hide');
                    // I don't like all the cross-template referencing going on here
                    refreshTable();
                    refreshCodeFilters(style_filter_dropdowns);
                },

                error: function (xhr, status) {
                    alert("Failed to edit filter");
                }
            });
        }
</script>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="submitFilterChanges()">Save changes</button>
            </div>
        </div>
    </div>
</div>
